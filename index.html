<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Couchdb-dump by raffi-minassian</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Couchdb-dump</h1>
        <h2>Tools to dump, modify, and load documents in CouchDB from the command line. (Same basic concept as mysqldump, but much more and for CouchDB)</h2>
        <a href="https://github.com/raffi-minassian/couchdb-dump" class="button"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>
<a id="couchdb-dump" class="anchor" href="#couchdb-dump" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>couchdb-dump</h1>

<p>A set of three command line tools that perform the following functions. </p>

<ul>
<li>
<code>cdbdump</code> outputs all documents (including any attachments) in a <a href="http://couchdb.apache.org">CouchDB</a> database</li>
<li>
<code>cdbmorph</code> lets you provide a function that can modify the documents in that output</li>
<li>
<code>cdbload</code> takes that output as input and loads it back into a CouchDB database.</li>
</ul>

<p>Reading and writing the data is done via stdin and stdout, respectively. The output of <code>cdbdump</code> is a JSON document containing a "docs" array element which contains the CouchDB database documents. The <code>cdbmorph</code> command takes the output of <code>cdbdump</code> and allows you to modify the documents in it by passing each of them through a function that you supply. The <code>cdbload</code> command takes an input which is exactly the same as the output of <code>cdbdump</code> or <code>cdbmorph</code> and writes every document in it into the target database.</p>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installation</h2>

<p><code>npm install -g couchdb-dump</code>
See also couchdb-dump on npm.</p>

<h2>
<a id="usage-examples" class="anchor" href="#usage-examples" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Usage Examples</h2>

<p>The following will dump the contents of a CouchDB database called <em>myhugedatabase</em> running on port 5984 on localhost. The output is written to a file called <em>myhugedatabase.json</em>.</p>

<p><code>cdbdump -d myhugedatabase &gt; myhugedatabase.json</code></p>

<p>If you are doing this for archiving purposes you could do something like this to extract and gzip by piping output ...</p>

<p><code>cdbdump -d myhugedatabase | gzip &gt; myhugedatabase.json.gz</code></p>

<p><a href="https://github.com/raffi-minassian/couchdb-dump/blob/master/README.md#cdbdump-full-usage">See the project README for more on the usage of the <code>cdbdump</code> command.</a></p>

<hr>

<p>Both of the following command examples will load all the documents in the <em>myhugedatabase.json</em> file into a CouchDB database called <em>myhugeduplicate</em>.</p>

<p><code>cdbload -d myhugeduplicate &lt; myhugedatabase.json</code><br>
 <strong>OR</strong><br>
<code>cat myhugedatabase.json | cdbload -d myhugeduplicate</code></p>

<p>You can even do this ...</p>

<p><code>cdbdump -d myhugedatabase | cdbload -d myhugeduplicate</code></p>

<p>... which streams all the docs from one CouchDB database into a second one. While this works well, you should probably take a look at using <a href="http://guide.couchdb.org/draft/replication.html">CouchDB's awesome built-in replication features</a> instead.</p>

<p><a href="https://github.com/raffi-minassian/couchdb-dump/blob/master/README.md#cdbload-full-usage">See the project README for more on the usage of the <code>cdbload</code> command.</a></p>

<hr>

<p>But suppose you need to manipulate the documents in the <code>cdbdump</code> output before you load them into CouchDB with <code>cdbload</code>. You can do that with the included <code>cdbmorph</code> command.</p>

<p>Lets assume you need to add a new key and value to all documents which meet certain criteria, and you need to delete documents which meet some other criteria. So you <a href="https://github.com/raffi-minassian/couchdb-dump/blob/master/README.md#functiondoc-callback">write a function</a> as follows and save it in a file called <em>morph.js</em>. For example:</p>

<pre><code>module.exports = function(doc, cb){
  if(doc.somekey &amp;&amp; doc.somekey === 'somevalue'){
    doc.anotherkey = 'anothervalue';
  }
  if(doc.someotherkey &amp;&amp; doc.someotherkey === 'someothervalue'){
    doc._deleted = true;
  }
  cb(null, doc);
}
</code></pre>

<p>Now you can run the documents in the <em>myhugedatabase.json</em> file from the example above through this function and feed the output into a file or directly back into a CouchDB database as follows ...</p>

<p><code>cat myhugedatabase.json | cdbmorph -f ./morph.js | cdbload -d myhugemodified</code></p>

<p>You can also pipe output directly from <code>cdbdump</code> to <code>cdbmorph</code> to <code>cdbload</code> like this ...</p>

<p><code>cdbdump -d myhugedatabase | cdbmorph -f ./morph.js | cdbload -d myhugemodified</code></p>

<p>You can even put modified documents back into a CouchDB database by loading the stream of changed documents back into the source database, simulating the feel of in-place-updates, like this ...</p>

<p><code>cdbdump -k -d myhugedatabase | cdbmorph -f ./morph.js | cdbload -d myhugedatabase</code></p>

<p><a href="https://github.com/raffi-minassian/couchdb-dump/blob/master/README.md#cdbmorph-full-usage">See the project README for more on the usage of the <code>cdbmorph</code> command.</a></p>

<hr>

<p><a href="https://github.com/raffi-minassian/couchdb-dump/blob/master/README.md#release-history">Release History</a></p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/raffi-minassian/couchdb-dump/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/raffi-minassian/couchdb-dump/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/raffi-minassian/couchdb-dump"></a> is maintained by <a href="https://github.com/raffi-minassian">raffi-minassian</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>
